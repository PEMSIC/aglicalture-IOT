
<source>
  @type mqtt
  host iot-emqx
  port 11883
  topic agriIoT/#
  <parse>
    @type json
  </parse>
</source>

<filter agriIoT.**>
  @type record_transformer
  <record>
    detect ${Time.now.strftime('%Y-%m-%d %H:%M:%S')}
  </record>
</filter>

<match agriIoT.one>
  @type mysql_bulk
  host iot-mysql
  port 3306
  database demo
  username root
  password root
  column_names id,node_name,user_name,message
  table message
  flush_interval 10s
</match>

<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# throw away
<match fluent.info>
  @type null
</match>

<match fluent.**>
  @type stdout
</match>

# error!
<match **>
  @type file
  path /var/log/td-agent/hoge.log
  buffer_chunk_limit 0
  buffer_queue_limit 0
</match>